9000  ;"CIATEST64.ML"9010  *       =$3200         ;128009020  N       LDA #$549030          LDX #$629040          BIT $FB        ;DOING TIMER B?9050          BMI TB1        ;YES9060          TAX            ;NO, SWITCH A,X9070          LDA #$629080  TB1     LDY #$039090          STA $DD04      ;TIMER A9100          STY $DD059110          STX $DD06      ;TIMER B9120          STY $DD079130          LDA #$11       ;START BOTH9140          STA $DD0E9150          STA $DD0F9160          LDX #$02       ;TIMER B FLAG9170          LDY #$07       ;  AND HI BYTE9180          BIT $FB        ;DOING TIMER B?9190          BMI TB2        ;YES9200          DEX            ;TIMER A FLAG9210          LDY #$05       ;  AND HI BYTE9220  TB2     STX $FC9230          STY BEFORE+1   ;OVERWRITE9240          STY AFTER+19250          TXA            ;ENABLE THE9260          EOR #$83       ;  OTHER TIMER9270          LDX #<NEWNMI9280          LDY #>NEWNMI9290          STX $03189300          STY $03199310          LDX $DD0D      ;CLEAR FLAGS9320          STA $DD0D      ;SET ENABLE9330          RTS9340  NEWNMI  PHA9350          TXA9360          PHA9370          TYA9380  BEFORE  LDY $DD07      ;SAMPLE HI BYTE9390          PHA9400          LDA $DD0D      ;READ REGISTER9410          CLD9420  AFTER   CPY $DD07      ;TIMEOUT?9430          BCS EXIT       ;NO9440          ORA $DD0D      ;READ AGAIN9450          AND $FC        ;WAS FLAG SET?9460          BNE EXIT       ;YES9470          LDA #$2A       ;NO, PRINT "*"9480          JSR $FFD29490  EXIT    JMP $FEBC      ;DO REGS, RTI